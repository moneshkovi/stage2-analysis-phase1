<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stage 2 Analysis App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #f0f0f0;
            margin: 0;
            padding: 0 1rem;
        }
        h1 {
            text-align: center;
        }
        section {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #1e1e1e;
            border-radius: 8px;
        }
        label {
            display: block;
            margin-top: 0.5rem;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            margin-top: 0.25rem;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #2a2a2a;
            color: #f0f0f0;
        }
        button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background-color: #007acc;
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            background-color: #005fa3;
        }
        pre {
            background-color: #272727;
            padding: 1rem;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Stage 2 Analysis Dashboard</h1>
    <section id="scan">
        <h2>Scan for Stage 2 Candidates</h2>
        <label for="scanTickers">Tickers (comma-separated)</label>
        <input type="text" id="scanTickers" placeholder="e.g. AAPL,MSFT,NVDA">
        <label for="scanBenchmark">Benchmark symbol</label>
        <input type="text" id="scanBenchmark" value="SPY">
        <label for="scanMA">MA Window (weeks)</label>
        <input type="number" id="scanMA" value="30">
        <button onclick="performScan()">Scan</button>
        <h3>Results</h3>
        <pre id="scanResult">[]</pre>
    </section>
    <section id="backtest">
        <h2>Backtest Stage 2 Strategy</h2>
        <label for="backtestTickers">Tickers (comma-separated)</label>
        <input type="text" id="backtestTickers" placeholder="e.g. AAPL,MSFT,NVDA">
        <label for="backtestBenchmark">Benchmark symbol</label>
        <input type="text" id="backtestBenchmark" value="SPY">
        <label for="backtestMA">MA Window (weeks)</label>
        <input type="number" id="backtestMA" value="30">
        <button onclick="performBacktest()">Backtest</button>
        <h3>Results</h3>
        <pre id="backtestResult">{}</pre>
    </section>
    <section id="train">
        <h2>Train Stage 2 ML Model</h2>
        <label for="trainTickers">Tickers (comma-separated)</label>
        <input type="text" id="trainTickers" placeholder="e.g. AAPL,MSFT,NVDA">
        <label for="trainBenchmark">Benchmark symbol</label>
        <input type="text" id="trainBenchmark" value="SPY">
        <label for="trainMA">MA Window (weeks)</label>
        <input type="number" id="trainMA" value="30">
        <label for="trainTestSize">Test size (0-1)</label>
        <input type="number" id="trainTestSize" value="0.2" step="0.05" min="0.05" max="0.5">
        <button onclick="trainModel()">Train Model</button>
        <h3>Results</h3>
        <pre id="trainResult">{}</pre>
    </section>

    <section id="predict">
        <h2>Predict Stage 2 Probability</h2>
        <label for="predictTickers">Tickers (comma-separated)</label>
        <input type="text" id="predictTickers" placeholder="e.g. AAPL,MSFT,NVDA">
        <label for="predictBenchmark">Benchmark symbol</label>
        <input type="text" id="predictBenchmark" value="SPY">
        <label for="predictMA">MA Window (weeks)</label>
        <input type="number" id="predictMA" value="30">
        <button onclick="predictStage()">Predict</button>
        <h3>Results</h3>
        <pre id="predictResult">{}</pre>
    </section>
    <script>
        async function performScan() {
            const tickers = document.getElementById('scanTickers').value.split(',').map(s => s.trim()).filter(Boolean);
            const benchmark = document.getElementById('scanBenchmark').value.trim();
            const maWindow = parseInt(document.getElementById('scanMA').value, 10) || 30;
            const resArea = document.getElementById('scanResult');
            resArea.textContent = 'Loading...';
            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tickers: tickers, benchmark: benchmark, maWindow: maWindow })
                });
                const data = await response.json();
                resArea.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                resArea.textContent = 'Error: ' + err;
            }
        }

        async function performBacktest() {
            const tickers = document.getElementById('backtestTickers').value.split(',').map(s => s.trim()).filter(Boolean);
            const benchmark = document.getElementById('backtestBenchmark').value.trim();
            const maWindow = parseInt(document.getElementById('backtestMA').value, 10) || 30;
            const resArea = document.getElementById('backtestResult');
            resArea.textContent = 'Loading...';
            try {
                const response = await fetch('/api/backtest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tickers: tickers, benchmark: benchmark, maWindow: maWindow })
                });
                const data = await response.json();
                resArea.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                resArea.textContent = 'Error: ' + err;
            }
        }

        async function trainModel() {
            const tickers = document.getElementById('trainTickers').value.split(',').map(s => s.trim()).filter(Boolean);
            const benchmark = document.getElementById('trainBenchmark').value.trim();
            const maWindow = parseInt(document.getElementById('trainMA').value, 10) || 30;
            const testSize = parseFloat(document.getElementById('trainTestSize').value) || 0.2;
            const resArea = document.getElementById('trainResult');
            resArea.textContent = 'Training...';
            try {
                const response = await fetch('/api/ml/train', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tickers: tickers, benchmark: benchmark, maWindow: maWindow, testSize: testSize })
                });
                const data = await response.json();
                resArea.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                resArea.textContent = 'Error: ' + err;
            }
        }

        async function predictStage() {
            const tickers = document.getElementById('predictTickers').value.split(',').map(s => s.trim()).filter(Boolean);
            const benchmark = document.getElementById('predictBenchmark').value.trim();
            const maWindow = parseInt(document.getElementById('predictMA').value, 10) || 30;
            const resArea = document.getElementById('predictResult');
            resArea.textContent = 'Predicting...';
            try {
                const response = await fetch('/api/ml/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tickers: tickers, benchmark: benchmark, maWindow: maWindow })
                });
                const data = await response.json();
                resArea.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                resArea.textContent = 'Error: ' + err;
            }
        }
    </script>
</body>
</html>
